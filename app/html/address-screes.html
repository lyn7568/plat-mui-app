<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="../css/mui.min.css" rel="stylesheet"/>
    <link href="../css/app.css" rel="stylesheet"/>
    <link href="../css/iconfont.css" rel="stylesheet" />
    <style type="text/css">
		.mui-table-view-cell:after {
		    right: 0;
		    bottom: 0;
		    left:15px; 
		}
		.menuposition {
		    border-radius: 4px;
		    position:fixed;
		    height: 100%; 
		    width: 100%;
		    font-size: 14px;
		  
		}
		#provinceval {
			padding-bottom:45px;
		}
		
	    </style>
</head>
<body>
	<header class="mui-bar mui-bar-nav toptitbox">
	    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left topback"></a>
	</header>
    <!-- 主页面内容容器 -->
    <div class="mui-content" >
    	<div id="middlePopovercity " class="menuposition" >
			<div class="mui-pull-left mui-scroll-wrapper" style=" width: 30%;border-right:1px solid #CFCFCF;">
				<ul class="mui-table-view provinceval mui-scroll" id="provinceval">
					
				</ul>
			</div>
			<div class="mui-pull-left mui-scroll-wrapper" style="width: 70%;left:30%;">
				<ul class="mui-table-view mui-scroll" id="addressval">
				
				</ul>
			</div>
		</div>
    </div>
   <script src="../js/public/mui.min.js"></script>
   <script src="../js/public/base.js"></script>
   <script type="text/javascript">
   		var provinceVal = document.getElementById("provinceval");
   		var addressVal = document.getElementById("addressval");
		mui('.mui-scroll-wrapper').scroll({
			deceleration: 0.0005, 
			indicators: false, //是否显示滚动条
			//bounce: false,
		});
		
		/*省会*/
		mui(".provinceval").on('tap', 'a', function() {
			var province = this.innerText;
			var address = document.querySelector('.provinceval li a.active').innerText;
			document.querySelector('#provinceval li a.active').classList.remove('active');
			this.classList.add("active");
			if(province == "全国") {
				//addressVal.innerHTML = "";
				var searchPage = plus.webview.getWebviewById('../html/search.html');
				mui.fire(searchPage, 'closesearch', {
					province: province,
					address:address
				});
			    mui.back();
			} else {
				mui.ajax(baseUrl + '/ajax/dataDict/qaCity', {
					data: {
						"dictCode": "ADDRESS",
						province: province
					},
					dataType: 'json', //数据格式类型
					type: 'GET', //http请求类型
					timeout: 10000,
					success: function(data) {
						if(province == "北京市" || province == "上海市" || province == "天津市" || province == "重庆市" ){
							var finallist = '';
						}else{
							var finallist = '<li class="mui-table-view-cell"><a class="active">全省</a></li>';
						}
						console.log(data.success)
						console.log(JSON.stringify(data.data))
						if(data.success && data.data != "") {
							mui.each(data.data, function(i, n) {
								finallist += '<li class="mui-table-view-cell"><a >' + n.caption + '</a></li>';
							});
							addressVal.innerHTML = finallist;
							addressVal.firstChild.childNodes.item(0).classList.add('active');
						}
		
					},
					error: function() {
						plus.nativeUI.toast("服务器链接超时", toastStyle);
					}
				});
			}
		});
		
		/*市检索*/
		mui("#addressval").on('tap', 'a', function() {
			var province = document.querySelector('.provinceval li a.active').innerText;
			var address = this.innerText;
			document.querySelector('#addressval li a.active').classList.remove('active');
			this.classList.add("active");
			var searchPage = plus.webview.getWebviewById('../html/search.html');
			mui.fire(searchPage, 'closesearch', {
				province: province,
				address:address
			});
		    mui.back();
		})
		
		mui.plusReady(function(){
			//省
			mui.ajax(baseUrl + '/ajax/dataDict/qaCity', {
				data: {
					"dictCode": "PROVINCE"
				},
				dataType: 'json', //数据格式类型
				type: 'GET', //http请求类型
				timeout: 10000,
				success: function(data) {
					var finallist = '<li class="mui-table-view-cell"><a class="active">全国</a></li>';
					console.log(data.success)
					console.log(JSON.stringify(data.data))
					if(data.success && data.data != "") {
						mui.each(data.data, function(i, n) {
							finallist += '<li class="mui-table-view-cell"><a >' + n.caption + '</a></li>';
						});
						provinceVal.innerHTML = finallist;
					}
					plus.webview.currentWebview().show("fade-in");
				    plus.nativeUI.closeWaiting();
			
				},
				error: function() {
					plus.nativeUI.toast("服务器链接超时", toastStyle);
				}
			});
		});
		
   </script>
</body>
</html>