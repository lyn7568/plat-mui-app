<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>登录</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/app.css" rel="stylesheet" />
	</head>

	<body>
	
		<div class="closebtn mui-action-back">
			<span class="mui-icon mui-icon-closeempty closeicon"></span>
			<!--<div class="closeicon"></div>-->
		</div>
		<div class="mui-content">
			<div class="logobox">
				<a class="logolink" href="javascript:;">
					<img class="logoimg" src="../images/logo.png" />
				</a>
			</div>
		    <form class="mui-input-group frmbox">
		        <div class="mui-input-row frm-input">
		            <input type="text" class="mui-input-clear frmtype" placeholder="请输入账号" id="username">
		        </div>
		        <div class="mui-input-row frm-input">
					<input id='password' type="password" class="frmtype" placeholder="请输入密码">
					<span id='forgetPassword' class="forgetword forgetword2">忘记密码<em class="mui-icon mui-icon-help"></em></span>
				</div>
		    </form>
		    
		    <div class="mui-content-padded frmbox">
				<button id='login' class="mui-btn mui-btn-block frmbtn frmactive2">登&nbsp;录</button>
				<button id='reg' class="mui-btn mui-btn-block mui-btn-outlined frmbtn">注&nbsp;册</button>
			</div>
			
			<div class="quickbox" style="display: none;">
				
				<span class="borderword">直接登录</span>
				<div class="quickway">
					<span class="mui-icon mui-icon-weixin quickicon weixinicon" id="weixin"></span>
					<span class="mui-icon mui-icon-weibo quickicon weiboicon"></span>
					<span class="mui-icon mui-icon-qq quickicon qqicon"></span>	
				</div>
			</div>
			
		</div>
		<script src="../js/public/mui.min.js"></script>
		<script src="../js/public/base.js"></script>
		<script src="../js/login.js"></script>
		<script type="text/javascript">
			var auths;
			mui.plusReady(function() {   
	            plus.oauth.getServices(function(services) { 
	                auths = services; 
	            }, function(e) { 
	                alert("获取登录服务列表失败：" + e.message + " - " + e.code); 
	            }); 
	        }) 
	        
	        document.getElementById('weixin').addEventListener('tap',function() { 
	            console.log("微信"); 
	            authLogin('weixin'); 
	        });
	        
	        function authLogin(type) { 
	            var s; 
	            for (var i = 0; i < auths.length; i++) { 
	                if (auths[i].id == type) { 
	                    s = auths[i]; 
	                    break; 
	                } 
	            } 
	            if (!s.authResult) { 
	                s.login(function(e) { 
	                    mui.toast("登录认证成功！"); 
	                    authUserInfo(type); 
	                }, function(e) { 
	                    mui.toast("登录认证失败！"); 
	                }); 
	            } else { 
	                mui.toast("已经登录认证！"); 
	            } 
	        } 
			
			// 微信登录认证信息 
	        function authUserInfo(type) { 
	            var s; 
	            for (var i = 0; i < auths.length; i++) { 
	                if (auths[i].id == type) { 
	                    s = auths[i]; 
	                    break; 
	                } 
	            } 
	            if (!s.authResult) { 
	                mui.toast("未授权登录！"); 
	            } else { 
	                s.getUserInfo(function(e) { 
	                    var josnStr = JSON.stringify(s.userInfo); 
	                    var jsonObj = s.userInfo; 
	                    console.log("获取用户信息成功：" + josnStr); 
	                    //showData(type,jsonObj); 
	                    authLogout(); 
	                }, function(e) { 
	                    alert("获取用户信息失败：" + e.message + " - " + e.code); 
	                }); 
	            } 
	        } 


		 //注销 
        function authLogout() { 
            for (var i in auths) { 
                var s = auths[i]; 
                if (s.authResult) { 
                    s.logout(function(e) { 
                        console.log("注销登录认证成功！"); 
                    }, function(e) { 
                        console.log("注销登录认证失败！"); 
                    }); 
                } 
            } 
        } 

		</script>
	</body>

</html>